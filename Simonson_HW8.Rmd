---
title: "Simonson_HW8"
author: "Martin A. Simonson"
date: "March 10, 2019"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# 1.) Rowan Adaptation

The rowan ( _Sorbus aucuparia_) is a tree that grows in a wide range of altitudes. To study how the tree adapts toits varying habitats, researchers collected twigs with attached buds from 12 trees growing at various altitudes in North Angus, Scotland.  The buds were brought back to the laboratory and measurements were made on the dark respiration rate.  The average altitude from the origin for the 12 trees is 433.33 meters. The average respiration  rate  computed  for  the  12  trees  is  0.21 $\mu l$ oxygen  per hour per  mg  dry weight  of  tissue. The standard deviation of the altitude for the 12 trees is 214.62 meters and for respiration rate is 0.077  $\mu l/(hour*mg^{-1})$ mg.The correlation between altitude from the origin and dark respiration rate($r_{xy}$) was 0.887.

## (a)

We will use linear regression to describe the relationship between altitude and dark respiration. Which of the two variables would most naturally be considered the explanatory variable and which would be the response variable?

- __Answer:__ The explanatory variable is the elevation from which the sample buds were taken, in meters. The response variable is the dark respiration rate in micrograms oxygen per hour per mg of dry bud tissue [$\mu l/(hour*mg^{-1})$].

## (b)

Compute the equation of the least squares regression line.

- __Answer:__ We want to fit the model $y=\hat{\beta_0} + \hat{\beta_1}*x$ where  $\hat{\beta_0}$ is constant and represents the least squares regression incercept, and $\hat{\beta_1}$ is constant and represents the least squares regression slope. To calculate this from available data, we first estimate $\hat{\beta_1}$ by:

\[
\hat{\beta_1} = r_{xy} * \frac{S_y}{S_x} 
\]

where $r_{xy}$ is the correlation coefficient of the two variables; the sample standard deviations for y (dark respiration) and x (elevation) are represented by $S_Y$ and $S_x$, respectively. 

```{r}
r.xy<-0.887
S.y<-0.077
S.x<-214.62

beta.1<-r.xy*(S.y/S.x)
beta.1
```



The formula for $\beta_0$ is given by: 

\[
\hat{\beta_0} = \bar{y} - \hat{\beta_1}*\bar{x}
\]

```{r}
y.bar<-0.21
x.bar<-433.33

beta.0<-y.bar-(beta.1*x.bar)
beta.0
```

Therefore, the equation of the least squares regression line for the respiration rate in response to tree altitude is:

\[
y = 0.07210043 + 0.0003182322*x
\]

## (c)

Compute a 95% confidence interval for the slope of the regression line.

- __Answer:__ We want to test $H_0: \beta_1 = 0$ vs. $H_A: \beta_1 \neq 0$. First we need to compute the root mean squared error (RMSE, $\hat{\sigma}$):

\[
RMSE = S_y * \sqrt{1-r{_{xy}^2}}
\]

```{r}
rmse<-S.y * sqrt(1-(r.xy^2))
rmse
```

Then, we compute the SE of $\beta_1$ with the following formula:

\[
SE(\hat{\beta_1}) = \frac{\hat{\sigma}}{\sqrt{(n-1)*S{_x^2}}}
\]

```{r}
se.beta.1<-rmse/sqrt((12-1)*(S.x^2))
se.beta.1
```

And compute the T-ratio

\[
T=\frac{\hat{\beta_1}}{SE(\hat{\beta_1})}
\]

```{r}
t.statistic<-beta.1/se.beta.1
t.statistic
```

We observe a t-statistic of 6.370812 with 10 degrees of freedom. From the t-table we find a twp-tailed p-value of less than 0.001, providing strong evidence to reject the null hypothesis. To complete the 95% confidnce interval, we use the formula:

\[
95\%CI = \hat{\beta_1} \pm t^* * SE(\hat{\beta_1})
\]

From the t-table, using 10 degrees of freedom, we find the $t^*$ from the t-table is 2.228. 

```{r}
lower<-beta.1-(2.228*se.beta.1)
upper<-beta.1+(2.228*se.beta.1)
CI<-data.frame(lower,upper)
CI
```

We are 95% confident that a 1 meter rise in altitude is accompanied by between 0.0002069401 and 0.0004295244 increase in respiration, measured as $\mu l/(hour*mg^{-1})$. The fact that the confidence interval for $\hat{\beta_1}$ does not include zero, along with the p-value above, provide very strong evidence that the slope of the the least squares regression line does not equal 0.

## (d) 

Estimate the mean respiration rate for a tree growing at 300 meters above origin.

```{r}
x<- 300
mu.300<- 0.07210043 + 0.0003182322*x
mu.300
```

- __Answer:__ We would expect the respiration rate for a tree growing at an elevation of 300 meters to be 0.1675701 $\mu l/(hour*mg^{-1})$.

## (e)

If the value of the new explanatory variable lies within one s.d. of the mean of the values of explanatory variables, the prediction is called interpolation, otherwise it is called extrapolation. Do you think your estimate in part (d) involved interpolation or extrapolation? Explain.

```{r}
x.range<-c((433.33 - 214.62),(433.33 + 214.62))
x.range
```

- __Answer:__ The value provided in part (d), 300 meters, is within one standard deviation of the mean elevation (218.71 meters to 647.95 meters), therefore, this estimate involved interpolation.

## (f)

Compute the s.e. of the mean respiration rate at 300 meters elevation.

- __Answer:__ Let $\hat{\mu}_{300}$ represent the mean predicted respiration rate at 300 meters elevation, as calculated by $\hat{\mu}_{300} = \hat{\beta_0} + \hat{\beta_1}*300$. We want to compute the standard error for $\hat{\mu}_{300}$:

\[
SE(\hat{\mu}_{300}) = \hat{\sigma} * \sqrt{\frac{1}{n} + \frac{(x-\bar{x})^2}{(n-1)*S{_x^2}}}
\]

Where $x$ is equal to 300, $\bar{x}$ is equal to 433.33, $n$ is equal to 12, and $S_x$ is equal to 214.62. 

```{r}
se.mu.300<-rmse*sqrt((1/12)+(((300-433.33)^2) / ((12-1)*(S.x^2))))
se.mu.300
```

The standard error of the mean respiration rate at 300 meters elevation is 0.01223561 $\mu l/(hour*mg^{-1})$.

# 2.) Old Faithful

The data in _eruption.csv_ are the interval waiting times ( _probably in minutes_) between eruptions and the duration of the eruption for the Old Faithful geyser in Yellowstone National Park, Wyoming. Ignore the date variable and consider all observations as one sample of X and Y values. Answer the following questions:

## (a) 

Fit the regression model that predicts interval from the duration of the last eruption and report the estimated intercept and slope.

```{r}
df<-read.csv("Data/eruption.csv",header=T)
summary(df)
df$interval<-as.numeric(as.character(df$interval))
model<-lm(interval~duration, data = df)
model$coefficients
```

- __Answer:__ The estimated interval length intercept is 33.8282 minutes with a slope of 10.7410 minutes of interval time per minute of eruption time.

## (b)

Calculate and report a 95% confidence interval for the slope

```{r}
confint(model,level=0.95)
```

- __Answer:__ We are 95% confident that the mean increase in interval time between eruptions lies between 9.499 and 11.983 minutes per minute of eruption duration.

## (c)

Test whether the slope equals 0. Report your test statistic, p-value and a one-sentence conclusion.

```{r}
summary(model)
```


- __Answer:__ Let $\beta$ represent the slope of the relationship between interval time and eruption time (both in minutes). We want to test: $H_0: \beta = 0$ vs. $H_A: \beta \neq 0$. The t-statistic for the effect of duration from our model summary is 17.15 on 105 degrees of freedom. The associated p-value less than 0.0001 provides very strong evidence to reject the null hypothesis and conclude the true slope of the relationship betweene eruption duration and interval is not equal to 0.

## (d)

Rangers at Yellowstone report a interval describing when they expect the next eruption to occur. Is it more appropriate to provie a confidence interval or a prediction interval? Briefly explain why.

- __Answer:__ The rangers should use a prediction interval because it will account for the scatter of data, and estimate variance around a predicted value.

# 3.) Wormyfruit

It is generally thought that the percentage of fruit attacked by codling moth larvae is greater on apple trees bearing a small crop. Apparently the density of the flying moths is unrelated to the size of the crop on a tree, so the chance of attack for any particular fruit is increased if few fruits are on the tree. Data collected for a random sample of 10 trees gives a sample linear correlation coefficient of -0.77. Other summary statistics obtained from the sample are provided below. The data are available in _wormyfruit.csv_.

Variable              | Sample Mean      | Sample Standard Deviation   
--------------------- | ---------------  | -------------------------- 
Crop Size (#fruit)    | 126.702          | 59.924
% wormy fruits        | 41.539           | 12.070

## (a)

Estimate the least-squares regression line for predicting percentage of wormy fruits from crop size. Show all your work in addition to the equation of the estimated model.

```{r}
df<-read.csv("Data/wormyfruit.csv",header=T)
str(df) # size of crop x; percent of fruit attacked is y
model<-lm(Perc~Size,data=df)
summary(model)
```

- __Answer:__ Let $Y$ be the percent of fruit attacked and let $X$ be the size of a crop. The equation for the estimated linear model of $Y$ in response to $X$ is:

\[
y = 62.96802 + (-0.16913 * x)
\]

## (b)

Write down the ANOVA table for the simple linear regression of percentage of wormy fruit on crop size. Compute the F statistic and find a p-value.

```{r}
anova(model)
```

- __Answer:__ The F-statistic is 11.62 with 8 and 1 degrees of freedom, and an observed p-value 0.00924. Therefore, we have strong evidence against the null hypothesis that the true effect of crop size is not equal to zero. 

## (c) 

Based on the F statistic and p-value computed in part (b), is there statistically significant evidence that the slope of the regression line is significantly different from 0?

- __Answer:__ There is strong evidence to reject the null hypothesis that the slope of the regression is equal to 0, and therefore conclude that the mean percentage of wormy fruit decreases with crop size.

## (d)

What proportion of the variability in the percentage of wormy fruit is explained by the regression of percentage of wormy fruit on crop size?

```{r}
anova(model)
SS.Between<-776.6
SS.Total<-534.67+776.6
SS.Between/SS.Total
```

- __Answer:__ The proportion of variability is given by the sum of squares between divdied by the sum of squares total. Therefore, the [unadjusted] proporition of variability in the percentage of wormy fruit that is explained by regression is 0.5922503, or 59.22%

- __Answer, Part 2:__ The model summary from (a) returns a more conservative [adjusted] $R^2$ of 0.5413, meaning about 54.13% of the variability in the percentage of wormy fruit is explained by the regression of percentage of wormy fruit on crop size.

## (e)

Estimate the mean percentage of wormy fruits for trees with a crop size of 150 fruit.

```{r}
new.data = data.frame(Size=c(150))

perc<-predict(model, newdata = new.data,se.fit = T,interval = "conf",level=0.95)
perc$fit # estimated percentage infestation at 150 apples
```

- __Answer:__ We expect 37.59 percent of apples would be infested with worms would if the crop size were 150 apples. 

## (f)

Provide a 95% confidence interval for the mean percentage of wormy fruits for trees witha crop size of 150 fruit.

```{r}
perc$fit
```

- __Answer:__ We are 95% confident that the interval for the mean percentage of wormy fruits for trees with a crop size of 150 fruit is between 31.07% and 44.13%.

## (g)

Is there a statistically significant evidence from these data that trees with a crop size of 150 have, on average, 50% wormy fruit?

- __Answer:__ No, we would not expect that another sample with a crop size of 150 apples would have 50% wormy fruit.

## (f)

Provide a 90% prediction interval for the average percentage of wormy fruit for the first tree with 150 fruit that was selected to be part of the study.

```{r}
perc2<-predict(model, newdata = new.data, se.fit = T, interval = "predict",level=0.90)
perc2$fit
```

- __Answer:__ The 90% prediction interval for the mean percentage of wormy fruit in a tree with 150 fruit is between 21.51% and 53.69%.

# 4.) Butterfly Diversity

The data in _diversity.csv_ are decribed in Chapter 8, problem 22 (both editions). Ecological theory suggests that the appropriate regression model is diversity = $\hat{\beta_0} + \hat{\beta_1} * log(area)$. Use this model for all questions below. The data come from an experimental study where the area of the patch was randomly assigned to plots of land.

## (a) 

Estimate the regression coefficients of the linear regression model suggested by ecological theory, then test whether the data provide evidence of a positive linear relationship between diversity and log(area). Report the estimates, the test statistic, and p-value for the test. 

```{r}
df<-read.csv("Data/diversity.csv",header=T)
str(df) # area x (hectares); number of species is y
df$log.area<-log(df$area)
model<-lm(species~log.area,data=df)
summary(model)
```

- __Answer:__ The estimate for $\hat{\beta_0}$ is 36.250; the estimate for $\hat{\beta_1}$ is 12.377. The data provide strong evidence of a positive linear relationship; we observe a t-statistic for $\hat{\beta_1}$ of 4.485 on 14 degrees of freedom, with a p-value of 0.000514.

## (b)

Does the mean diversity vary linearly with log(area), or does a model that allows the mean diversity to follow some other pattern appear to fit the data better? Provide the hypotheses, test statistic and a p-value in addition to your conclusion. __Only do a visual test for the assumptions of linearity.__

```{r, echo = F}
library(ggplot2)
library(gridExtra)
p1<-ggplot(model)+
  geom_point(aes(x=.fitted,y=.resid))+
  geom_abline(aes(intercept=0,slope=0))+
  theme_classic()
p2<-ggplot(df,aes(sample = log.area))+
  stat_qq()+
  stat_qq_line()+
  theme_classic()
grid.arrange(p1,p2,ncol=2)
```

- __Answer:__ The residual plot shows a concentration of points distributed broadly along the y-axis but concentrated at discrete intervals along the x-axis. The points in the QQ-plot do not fall along the QQ line, and appear to have disjointed trends in the data (number of species is a discrete variable). Therefore, I believe the assumptions of least squares linear regression are violated.

## (c) 

The investigators are interested in using this model to predict the number of species on new patches of forest. 

### (i) What is the area of a patch that has the smallest standard error for the predictions of the mean number of species? 

```{r}
exp(mean(df$log.area))
```


- __Answer:__ The uncertainty in prediction on an estimate is smallest when $x=\bar{x}$. Therefore, the area of the patch that has the smallest standard error around the predictions of the mean number of species is 10 hectares.


### (ii) What is the area of a patch that has the smallest standard error for predictions of number of species in an individual patch?

- __Answer:__ The uncertainty in prediction on an estimate is smallest when $x=\bar{x}$. Therefore, the area of the patch that has the smallest standard error the around the predicted number of species in an individual patch is 10 hectares.

## (d) 

The investigators would really like to make predictions of diversity in an individual patch that has standard errors less than 20 species. Is that possible with this model and data? Explain why or why not.

```{r}
summary(model)
sigma.hat<-23.78
n <- 16
# minimum prediction error for individual response.
min.pe<-sigma.hat*sqrt(1+(1/n))
min.pe

```

- __Answer:__ No, the minimum attainable prediction error (p.e.) for a predicted individual patch response is 24.51186.

## (e)

The study that produced these data has attracted a lot of international attention. Imagine that this study can be repeated with 10 times as many plots (160 instead of the 16 here). All else about the system remains the same: the regression intercept, slope, and error variance (i.e. $\hat{\sigma}$) are the same as here. Will this study be able to predict diversity in an individual patch with a standard error less than 20 species? Briefly explain why or why not.

```{r}
summary(model)
sigma.hat<-23.78
n2 <- 160
# minimum prediction error for individual response.
min.pe2<-sigma.hat*sqrt(1+(1/n2))
min.pe2

```

- __Answer:__ No, the minimum attainable prediction error for an individual patch, when the sample size is increased to 160, is 23.8542. 


# 5.) Manatees

Manatees (a.k.a. sea cows) live off the coast of Florida and unfortunately, many manatees are killed or injured by powerboats every year. The file _manatee.csv_ contains data on X = the number of Florida powerboat registrations (in 1000s) and Y = number of manatees killed near Florida. There is one point for each year from 1977 to 1990.

## (a)

Use software to construct a scatterplot between the number of manates killed and number of Florida power boat registrations. Is the relationship roughly linear?

```{r,include=F}
df<-read.csv("Data/manatee.csv",header=T)
str(df)
library(ggplot2)
p1<-ggplot(df,aes(x=X,y=Y))+
  geom_point()+
  theme_classic()+
  labs(x="Number of Florida Powerboat Registrations (1,000s)",
       y="Number of Mantaees Killed")

```
```{r, echo=F}
p1
```


- __Answer:__ The scatterplot shows that the number of powerboat registrations, in thousands, is roughly linearly correlated with the number of mantaees killed.

## (b)

Compute the correlation coefficient between two variables. Describe what this value says about the relationship between X and Y, in the context of the study.

```{r}
cor(df)
```

- __Answer:__ The correlation coefficeint for the two variables is 0.9414773, indicating a strong positive relationship between the number of manatees killed and the number of Florida powerboat registrations (in thousands).

## (c)

Give the equation of the least-squares regression line for predicting the number of manatee deaths as a function of powerboat registrations.

```{r}
model<-lm(Y~X, data = df)
summary(model)
```

- __Answer:__ Given the mantaee data, our observed $\hat{\beta_0}$ for the intercept of the least-squares regression line is -41.4304 and our observed $\hat{\beta_1}$ for the least squares regression slope is 0.1249. Therefore;

\[
Y = -41.304 + (0.1249 * X)
\]

## (d)

Predict the number of manatee deaths for a year in which 600,000 powerboats are registered in Florida (X=600). 

```{r}
new.data<-data.frame(X = 600)
est<-predict(model, newdata = new.data, se.fit = T,interval = "pred",level=0.95)
est$fit
```

- __Answer:__ The estimated mean number of manatee deaths in one year when there are 600,000 powerboats registered in Florida is 33.48658.

## (e)

Provide a 95% prediction interval for the number of manatee deaths in a year in which 600,000 powerboats are registered in Florida.

- __Answer:__ Given the output from part (d), we are 95% certain that the mean number of manatee deaths is between 23.7981 and 43.17425 when there are 600,000 powerboats registered in Florida .

## (f)

Examine the residual plot and the normal probability plot of the residuals from the simple linear regression model. Is there an indication that the assumptions of the model are violated? Explain why or why not.

```{r,echo=F}
library(gridExtra)
library(ggplot2)
p1<-ggplot(model)+
  geom_point(aes(x=.fitted,y=.resid))+
  geom_abline(aes(intercept=0,slope=0))+
  theme_classic()
#p1
p2<-ggplot(df,aes(sample = Y))+
  stat_qq()+
  stat_qq_line()+
  theme_classic()
#p2
grid.arrange(p1,p2,ncol=2)
```

- __Answer:__ Using personal judgement of visual displays of the residual plot (left) and QQ plot (right), I do not think that there is any strong evidence to conclude these assumptions have been violated. The residual plot shows that the residuals are centered around zero with no pattern as fitted values increase. Similarly, the QQ plot shows that the points fall roughly along a straight line. An interested researcher may choose to log-transform the variables to obtain a better fit, but the conclusions may not be drastically different.
